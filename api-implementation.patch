From acf672d0a642ed6703689c22f8c9b9f78f0a38d5 Mon Sep 17 00:00:00 2001
From: neolite <ufadiz@gmail.com>
Date: Fri, 5 Sep 2025 09:39:43 +0300
Subject: [PATCH] Add API routes for project generation and session-based
 updates
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- Add /api/generate endpoint for single-shot project generation
- Add /api/generate/chat endpoint for session-based iterative updates
- Add /api/generate/session/{sessionId} endpoints for session management
- Implement KV storage for persistent chat sessions (24h TTL)
- Add comprehensive Swagger documentation in api-docs.yaml
- Support both standalone generation and iterative chat-based workflow
- Compatible with existing UI chat functionality

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
---
 CLAUDE.md                                     | 106 ++++
 api-docs.yaml                                 | 526 ++++++++++++++++++
 app/api/generate/chat/route.ts                | 273 +++++++++
 app/api/generate/route.ts                     | 223 ++++++++
 app/api/generate/session/[sessionId]/route.ts | 158 ++++++
 5 files changed, 1286 insertions(+)
 create mode 100644 CLAUDE.md
 create mode 100644 api-docs.yaml
 create mode 100644 app/api/generate/chat/route.ts
 create mode 100644 app/api/generate/route.ts
 create mode 100644 app/api/generate/session/[sessionId]/route.ts

diff --git a/CLAUDE.md b/CLAUDE.md
new file mode 100644
index 0000000..90240a9
--- /dev/null
+++ b/CLAUDE.md
@@ -0,0 +1,106 @@
+# CLAUDE.md
+
+This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.
+
+## Development Commands
+
+```bash
+# Start development server with turbo mode
+npm run dev
+
+# Build the application
+npm run build
+
+# Start production server
+npm start
+
+# Run linting
+npm run lint
+```
+
+## Architecture Overview
+
+This is a Next.js 14 application that provides an AI-powered code generation platform similar to Claude Artifacts, v0, or GPT Engineer. The app uses the E2B SDK to execute generated code in secure sandboxes.
+
+### Core Technologies
+- **Next.js 14** with App Router and Server Actions
+- **TypeScript** with strict mode enabled
+- **Tailwind CSS** with shadcn/ui components
+- **Vercel AI SDK** for LLM integration
+- **E2B Code Interpreter** for secure code execution
+- **Supabase** for authentication (optional)
+- **Upstash KV** for rate limiting and short URLs (optional)
+
+### Key Directories
+
+- `/app` - Next.js App Router pages and API routes
+  - `/api/chat` - Main chat API endpoint for LLM interactions
+  - `/api/sandbox` - E2B sandbox management
+  - `/actions` - Server actions for publishing and validation
+- `/components` - React components
+  - `/ui` - shadcn/ui component library
+- `/lib` - Shared utilities and configuration
+  - `models.json` - Available LLM models configuration
+  - `templates.json` - Supported coding environments (Python, Next.js, Vue.js, Streamlit, Gradio)
+  - `models.ts` - LLM provider configurations and client setup
+  - `templates.ts` - Template management logic
+- `/sandbox-templates` - E2B template definitions for different coding environments
+- `/public/thirdparty` - Third-party logos and assets
+
+### LLM Provider Support
+
+The application supports multiple LLM providers configured in `lib/models.ts`:
+- OpenAI (GPT-4o, o1, etc.)
+- Anthropic (Claude 3.5 Sonnet, Haiku)
+- Google (Gemini models via Vertex AI and Generative AI)
+- Mistral (various models including Codestral)
+- Groq, Fireworks, Together AI
+- xAI (Grok models)
+- Ollama (for local models)
+
+### Template System
+
+Templates define different coding environments in `lib/templates.json`:
+- **code-interpreter-v1**: Python data analysis with Jupyter
+- **nextjs-developer**: Next.js applications
+- **vue-developer**: Vue.js applications  
+- **streamlit-developer**: Streamlit apps
+- **gradio-developer**: Gradio interfaces
+
+Each template specifies libraries, entry files, instructions, and ports.
+
+### Environment Configuration
+
+Key environment variables (see `.env.template`):
+- `E2B_API_KEY` - Required for code execution
+- `OPENAI_API_KEY`, `ANTHROPIC_API_KEY`, etc. - LLM provider keys
+- `SUPABASE_URL`, `SUPABASE_ANON_KEY` - Authentication (optional)
+- `KV_REST_API_URL`, `KV_REST_API_TOKEN` - Upstash KV (optional)
+- `NEXT_PUBLIC_POSTHOG_KEY` - Analytics (optional)
+
+### Code Execution Flow
+
+1. User sends messages via `/api/chat`
+2. LLM generates structured response using Zod schema (`lib/schema.ts`)
+3. Code execution happens via E2B sandbox API (`/api/sandbox`)
+4. Real-time streaming updates sent back to client
+
+### Rate Limiting
+
+Rate limiting is implemented for users without API keys using Upstash KV storage. Default: 10 requests per day, configurable via environment variables.
+
+## Adding New Features
+
+### Adding LLM Models
+1. Add model configuration to `lib/models.json`
+2. Update provider configurations in `lib/models.ts` if needed
+3. Add provider logo to `public/thirdparty/logos/` if new provider
+
+### Adding Templates
+1. Create new template folder in `sandbox-templates/`
+2. Use E2B CLI to initialize and build template
+3. Add template configuration to `lib/templates.json`
+4. Add template logo to `public/thirdparty/templates/` (optional)
+
+### Path Aliases
+- `@/*` maps to project root for clean imports
\ No newline at end of file
diff --git a/api-docs.yaml b/api-docs.yaml
new file mode 100644
index 0000000..1ab754a
--- /dev/null
+++ b/api-docs.yaml
@@ -0,0 +1,526 @@
+openapi: 3.0.0
+info:
+  title: Fragments API
+  description: API Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼Ð¸ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ AI Ð¸ E2B sandboxes
+  version: 1.0.0
+  contact:
+    name: Fragments
+    url: https://github.com/e2b-dev/fragments
+
+servers:
+  - url: http://localhost:3000
+    description: Development server
+  - url: https://your-domain.com
+    description: Production server
+
+paths:
+  /api/generate:
+    post:
+      summary: Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
+      description: |
+        Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚Ð°, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ LLM Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð´Ð° 
+        Ð¸ E2B Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ sandbox Ñ Ð¿Ñ€ÐµÐ²ÑŒÑŽ.
+      requestBody:
+        required: true
+        content:
+          application/json:
+            schema:
+              type: object
+              required:
+                - prompt
+              properties:
+                prompt:
+                  type: string
+                  description: Ð¢ÐµÐºÑÑ‚ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚Ð° Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
+                  example: "Create a simple todo app with Next.js"
+                model:
+                  type: string
+                  description: ÐœÐ¾Ð´ÐµÐ»ÑŒ LLM Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ
+                  default: "gpt-4o"
+                  enum:
+                    - "gpt-4o"
+                    - "gpt-4"
+                    - "gpt-3.5-turbo"
+                  example: "gpt-4o"
+                template:
+                  type: string
+                  description: Ð¨Ð°Ð±Ð»Ð¾Ð½ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
+                  default: "nextjs-developer"
+                  enum:
+                    - "code-interpreter-v1"
+                    - "nextjs-developer"
+                    - "vue-developer"
+                    - "streamlit-developer"
+                    - "gradio-developer"
+                  example: "nextjs-developer"
+                sessionId:
+                  type: string
+                  description: ID ÑÐµÑÑÐ¸Ð¸ Ð´Ð»Ñ Ð¸Ñ‚ÐµÑ€Ð°Ñ‚Ð¸Ð²Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ (ÐµÑÐ»Ð¸ ÑƒÐºÐ°Ð·Ð°Ð½, Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ñ‡Ð°Ñ‚ API)
+                  example: "session_abc123xyz"
+            examples:
+              simple_todo:
+                summary: ÐŸÑ€Ð¾ÑÑ‚Ð¾Ðµ todo Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
+                value:
+                  prompt: "Create a simple todo app with Next.js"
+              weather_dashboard:
+                summary: Dashboard Ñ Ð¿Ð¾Ð³Ð¾Ð´Ð¾Ð¹
+                value:
+                  prompt: "Create a weather dashboard with charts and current weather"
+                  model: "gpt-4o"
+                  template: "nextjs-developer"
+              python_analysis:
+                summary: Python Ð°Ð½Ð°Ð»Ð¸Ð· Ð´Ð°Ð½Ð½Ñ‹Ñ…
+                value:
+                  prompt: "Create a data analysis script for sales data with visualizations"
+                  template: "code-interpreter-v1"
+      responses:
+        '200':
+          description: ÐŸÑ€Ð¾ÐµÐºÑ‚ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½
+          content:
+            application/json:
+              schema:
+                type: object
+                properties:
+                  id:
+                    type: string
+                    description: Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ID ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ sandbox
+                    example: "imy24gfmqdtgszpdq7g37-6532622b"
+                  previewUrl:
+                    type: string
+                    format: uri
+                    description: ÐŸÑ€ÑÐ¼Ð°Ñ ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð¿Ñ€ÐµÐ²ÑŒÑŽ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð² E2B
+                    example: "https://3000-imy24gfmqdtgszpdq7g37-6532622b.e2b.app"
+                  shortUrl:
+                    type: string
+                    format: uri
+                    description: ÐšÐ¾Ñ€Ð¾Ñ‚ÐºÐ°Ñ ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚ (ÐµÑÐ»Ð¸ KV Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½)
+                    example: "https://fragments.dev/s/abc123"
+                  title:
+                    type: string
+                    description: ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
+                    example: "Todo App"
+                  description:
+                    type: string
+                    description: ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
+                    example: "A simple Next.js todo application"
+                  sessionId:
+                    type: string
+                    description: ID ÑÐµÑÑÐ¸Ð¸ (ÐµÑÐ»Ð¸ Ð±Ñ‹Ð»Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð° Ð½Ð¾Ð²Ð°Ñ ÑÐµÑÑÐ¸Ñ)
+                    example: "session_abc123xyz"
+                  messageCount:
+                    type: integer
+                    description: ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð² ÑÐµÑÑÐ¸Ð¸
+                    example: 2
+                  fragmentCount:
+                    type: integer
+                    description: ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð¾Ð² Ð² ÑÐµÑÑÐ¸Ð¸
+                    example: 1
+        '400':
+          description: ÐÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ
+          content:
+            application/json:
+              schema:
+                type: object
+                properties:
+                  error:
+                    type: string
+                    example: "Prompt is required"
+        '403':
+          description: ÐžÑˆÐ¸Ð±ÐºÐ° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸ API
+          content:
+            text/plain:
+              schema:
+                type: string
+                example: "Access denied. Please check your API configuration."
+        '429':
+          description: ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½ Ð»Ð¸Ð¼Ð¸Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
+          content:
+            text/plain:
+              schema:
+                type: string
+                example: "The provider is currently unavailable due to request limit."
+        '500':
+          description: Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°
+          content:
+            text/plain:
+              schema:
+                type: string
+                example: "An unexpected error has occurred. Please try again later."
+        '503':
+          description: Ð¡ÐµÑ€Ð²Ð¸Ñ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ (Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹ API ÐºÐ»ÑŽÑ‡Ð¸)
+          content:
+            application/json:
+              schema:
+                type: object
+                properties:
+                  error:
+                    type: string
+                    example: "OpenAI API key not configured. Please set OPENAI_API_KEY environment variable."
+
+  /api/generate/chat:
+    post:
+      summary: Ð§Ð°Ñ‚-based Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ ÑÐµÑÑÐ¸ÑÐ¼Ð¸
+      description: |
+        Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ñ‡Ð°Ñ‚-ÑÐµÑÑÐ¸Ð¸. ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð¸Ñ‚ÐµÑ€Ð°Ñ‚Ð¸Ð²Ð½ÑƒÑŽ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ 
+        Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸ÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° Ð¼ÐµÐ¶Ð´Ñƒ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ð¼Ð¸.
+      requestBody:
+        required: true
+        content:
+          application/json:
+            schema:
+              type: object
+              required:
+                - message
+              properties:
+                sessionId:
+                  type: string
+                  description: ID ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¹ ÑÐµÑÑÐ¸Ð¸ (ÐµÑÐ»Ð¸ Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½, ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ð½Ð¾Ð²Ð°Ñ)
+                  example: "session_abc123xyz"
+                message:
+                  type: string
+                  description: Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ/Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
+                  example: "Add dark mode toggle to the todo app"
+                model:
+                  type: string
+                  description: ÐœÐ¾Ð´ÐµÐ»ÑŒ LLM
+                  default: "gpt-4o"
+                  example: "gpt-4o"
+                template:
+                  type: string
+                  description: Ð¨Ð°Ð±Ð»Ð¾Ð½ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
+                  default: "nextjs-developer"
+                  example: "nextjs-developer"
+            examples:
+              new_session:
+                summary: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð¹ ÑÐµÑÑÐ¸Ð¸
+                value:
+                  message: "Create a todo app with Next.js"
+              continue_session:
+                summary: ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¹ ÑÐµÑÑÐ¸Ð¸
+                value:
+                  sessionId: "session_abc123xyz"
+                  message: "Add dark mode toggle"
+      responses:
+        '200':
+          description: ÐŸÑ€Ð¾ÐµÐºÑ‚ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½/Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½
+          content:
+            application/json:
+              schema:
+                type: object
+                properties:
+                  sessionId:
+                    type: string
+                    example: "session_abc123xyz"
+                  id:
+                    type: string
+                    example: "sandbox-12345"
+                  previewUrl:
+                    type: string
+                    example: "https://3000-sandbox.e2b.app"
+                  shortUrl:
+                    type: string
+                    example: "https://fragments.dev/s/abc123"
+                  title:
+                    type: string
+                    example: "Todo App with Dark Mode"
+                  description:
+                    type: string
+                    example: "Enhanced todo application with dark mode support"
+                  messageCount:
+                    type: integer
+                    example: 4
+                  fragmentCount:
+                    type: integer
+                    example: 2
+
+  /api/generate/session/{sessionId}:
+    get:
+      summary: ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ ÑÐµÑÑÐ¸Ð¸
+      description: Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¿Ð¾Ð»Ð½ÑƒÑŽ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð¸ Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð¾Ð² ÑÐµÑÑÐ¸Ð¸
+      parameters:
+        - name: sessionId
+          in: path
+          required: true
+          schema:
+            type: string
+          example: "session_abc123xyz"
+      responses:
+        '200':
+          description: Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ ÑÐµÑÑÐ¸Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾
+          content:
+            application/json:
+              schema:
+                type: object
+                properties:
+                  sessionId:
+                    type: string
+                    example: "session_abc123xyz"
+                  messages:
+                    type: array
+                    items:
+                      type: object
+                      properties:
+                        role:
+                          type: string
+                          enum: ["user", "assistant"]
+                        content:
+                          type: string
+                        timestamp:
+                          type: integer
+                  fragments:
+                    type: array
+                    items:
+                      type: object
+                  template:
+                    type: string
+                    example: "nextjs-developer"
+                  model:
+                    type: string
+                    example: "gpt-4o"
+                  messageCount:
+                    type: integer
+                    example: 4
+                  fragmentCount:
+                    type: integer
+                    example: 2
+                  createdAt:
+                    type: integer
+                    example: 1630000000000
+                  updatedAt:
+                    type: integer
+                    example: 1630001000000
+        '404':
+          description: Ð¡ÐµÑÑÐ¸Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°
+        '503':
+          description: Ð¥Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ ÑÐµÑÑÐ¸Ð¹ Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¾
+    delete:
+      summary: Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐµÑÑÐ¸ÑŽ
+      description: Ð£Ð´Ð°Ð»ÑÐµÑ‚ ÑÐµÑÑÐ¸ÑŽ Ð¸ Ð²ÑÑŽ ÑÐ²ÑÐ·Ð°Ð½Ð½ÑƒÑŽ Ñ Ð½ÐµÐ¹ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ
+      parameters:
+        - name: sessionId
+          in: path
+          required: true
+          schema:
+            type: string
+          example: "session_abc123xyz"
+      responses:
+        '200':
+          description: Ð¡ÐµÑÑÐ¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°
+          content:
+            application/json:
+              schema:
+                type: object
+                properties:
+                  message:
+                    type: string
+                    example: "Session deleted successfully"
+
+components:
+  schemas:
+    GenerateRequest:
+      type: object
+      required:
+        - prompt
+      properties:
+        prompt:
+          type: string
+          minLength: 1
+          maxLength: 4000
+        model:
+          type: string
+          default: "gpt-4o"
+        template:
+          type: string
+          default: "nextjs-developer"
+
+    GenerateResponse:
+      type: object
+      properties:
+        id:
+          type: string
+        previewUrl:
+          type: string
+          format: uri
+        shortUrl:
+          type: string
+          format: uri
+        title:
+          type: string
+        description:
+          type: string
+
+    Error:
+      type: object
+      properties:
+        error:
+          type: string
+
+# Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸ÑŽ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²
+x-update-documentation: |
+  ## ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²
+
+  Ð’ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ð²ÐµÑ€ÑÐ¸Ð¸ API Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ñ€ÑÐ¼Ð¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð².
+  ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð² `/api/generate` ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ð¹ sandbox Ð¸ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚.
+
+  ### Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ñ‹ Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ:
+
+  1. **Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ñ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸ÑÐ¼Ð¸**
+     ```bash
+     curl -X POST http://localhost:3000/api/generate \
+       -H "Content-Type: application/json" \
+       -d '{
+         "prompt": "Create a todo app with Next.js and add authentication with NextAuth"
+       }'
+     ```
+
+  2. **Ð‘ÑƒÐ´ÑƒÑ‰Ð¸Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸** (Ð½Ðµ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ñ‹):
+     - `PATCH /api/generate/{id}` - Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
+     - `PUT /api/generate/{id}/files` - Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ
+     - `POST /api/generate/{id}/chat` - Ñ‡Ð°Ñ‚ Ð´Ð»Ñ Ð¸Ñ‚ÐµÑ€Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹
+
+  ### Ð¢ÐµÐºÑƒÑ‰Ð¸Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ:
+  - Sandbox Ð¶Ð¸Ð²ÐµÑ‚ 10 Ð¼Ð¸Ð½ÑƒÑ‚ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
+  - ÐÐµÑ‚ Ð¿ÐµÑ€ÑÐ¸ÑÑ‚ÐµÐ½Ñ‚Ð½Ð¾Ð³Ð¾ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹
+  - ÐšÐ°Ð¶Ð´Ð°Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¸Ð·Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚
+
+# ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
+x-environment-variables: |
+  ## ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
+
+  ```bash
+  # E2B API Key - Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ sandbox
+  E2B_API_KEY=your_e2b_api_key
+
+  # OpenAI API Key - Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð´Ð°
+  OPENAI_API_KEY=your_openai_api_key
+  ```
+
+  ## ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
+
+  ```bash
+  # Ð”Ð»Ñ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ñ… ÑÑÑ‹Ð»Ð¾Ðº (Upstash KV)
+  KV_REST_API_URL=your_kv_url
+  KV_REST_API_TOKEN=your_kv_token
+
+  # Ð”Ð»Ñ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ (Supabase)
+  SUPABASE_URL=your_supabase_url
+  SUPABASE_ANON_KEY=your_supabase_key
+
+  # Ð”Ð¾Ð¼ÐµÐ½ ÑÐ°Ð¹Ñ‚Ð°
+  NEXT_PUBLIC_SITE_URL=your_domain.com
+  ```
+
+# ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ
+x-examples: |
+  ## ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ
+
+  ### 1. ÐŸÑ€Ð¾ÑÑ‚Ð¾Ðµ Next.js Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
+  ```bash
+  curl -X POST http://localhost:3000/api/generate \
+    -H "Content-Type: application/json" \
+    -d '{
+      "prompt": "Create a landing page for a SaaS product with pricing section"
+    }'
+  ```
+
+  ### Ð˜Ñ‚ÐµÑ€Ð°Ñ‚Ð¸Ð²Ð½Ð°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼Ð¸ (Ð½Ð¾Ð²Ð¾Ðµ!)
+
+  ### 2. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð¹ ÑÐµÑÑÐ¸Ð¸
+  ```bash
+  # Ð¨Ð°Ð³ 1: Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð±Ð°Ð·Ð¾Ð²Ð¾Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
+  curl -X POST http://localhost:3000/api/generate/chat \
+    -H "Content-Type: application/json" \
+    -d '{
+      "message": "Create a todo app with Next.js"
+    }'
+
+  # ÐžÑ‚Ð²ÐµÑ‚: {"sessionId": "session_abc123xyz", "id": "sandbox-1", ...}
+  ```
+
+  ### 3. ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð² ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¹ ÑÐµÑÑÐ¸Ð¸
+  ```bash
+  # Ð¨Ð°Ð³ 2: Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ñ‚ÐµÐ¼Ð½ÑƒÑŽ Ñ‚ÐµÐ¼Ñƒ
+  curl -X POST http://localhost:3000/api/generate/chat \
+    -H "Content-Type: application/json" \
+    -d '{
+      "sessionId": "session_abc123xyz",
+      "message": "Add dark mode toggle to the todo app"
+    }'
+
+  # Ð¨Ð°Ð³ 3: Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸ÑŽ
+  curl -X POST http://localhost:3000/api/generate/chat \
+    -H "Content-Type: application/json" \
+    -d '{
+      "sessionId": "session_abc123xyz", 
+      "message": "Add user authentication with NextAuth"
+    }'
+  ```
+
+  ### 4. ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ ÑÐµÑÑÐ¸Ð¸
+  ```bash
+  curl -X GET http://localhost:3000/api/generate/session/session_abc123xyz
+  ```
+
+  ### 5. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ sessionId Ð² Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¼ API
+  ```bash
+  curl -X POST http://localhost:3000/api/generate \
+    -H "Content-Type: application/json" \
+    -d '{
+      "sessionId": "session_abc123xyz",
+      "prompt": "Add database integration with Prisma"
+    }'
+  ```
+
+  ### 2. Python Ð°Ð½Ð°Ð»Ð¸Ð· Ð´Ð°Ð½Ð½Ñ‹Ñ…
+  ```bash
+  curl -X POST http://localhost:3000/api/generate \
+    -H "Content-Type: application/json" \
+    -d '{
+      "prompt": "Analyze CSV data with pandas and create visualizations",
+      "template": "code-interpreter-v1"
+    }'
+  ```
+
+  ### 3. Vue.js Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
+  ```bash
+  curl -X POST http://localhost:3000/api/generate \
+    -H "Content-Type: application/json" \
+    -d '{
+      "prompt": "Create a Vue.js dashboard with charts and tables",
+      "template": "vue-developer"
+    }'
+  ```
+
+  ### 4. Streamlit Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
+  ```bash
+  curl -X POST http://localhost:3000/api/generate \
+    -H "Content-Type: application/json" \
+    -d '{
+      "prompt": "Create a machine learning model evaluation dashboard",
+      "template": "streamlit-developer"
+    }'
+  ```
+
+  ## ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾Ñ‚Ð²ÐµÑ‚Ð°
+
+  ```javascript
+  const response = await fetch('http://localhost:3000/api/generate', {
+    method: 'POST',
+    headers: {
+      'Content-Type': 'application/json',
+    },
+    body: JSON.stringify({
+      prompt: 'Create a todo app with Next.js'
+    })
+  });
+
+  if (response.ok) {
+    const data = await response.json();
+    console.log('Project created:', data);
+    
+    // ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€ÐµÐ²ÑŒÑŽ
+    window.open(data.previewUrl, '_blank');
+  } else {
+    console.error('Error:', await response.text());
+  }
+  ```
\ No newline at end of file
diff --git a/app/api/generate/chat/route.ts b/app/api/generate/chat/route.ts
new file mode 100644
index 0000000..b639e81
--- /dev/null
+++ b/app/api/generate/chat/route.ts
@@ -0,0 +1,273 @@
+import { Duration } from '@/lib/duration'
+import {
+  getModelClient,
+  LLMModel,
+  LLMModelConfig,
+} from '@/lib/models'
+import { toPrompt } from '@/lib/prompt'
+import { fragmentSchema as schema } from '@/lib/schema'
+import templates, { TemplateId } from '@/lib/templates'
+import { publish } from '@/app/actions/publish'
+import { generateObject, LanguageModel, CoreMessage } from 'ai'
+import { Sandbox } from '@e2b/code-interpreter'
+import { kv } from '@vercel/kv'
+import { customAlphabet } from 'nanoid'
+
+export const maxDuration = 300
+
+const sandboxTimeout = 10 * 60 * 1000 // 10 minutes in ms
+const nanoid = customAlphabet('1234567890abcdefghijklmnopqrstuvwxyz', 10)
+
+type ChatMessage = {
+  role: 'user' | 'assistant'
+  content: string
+  timestamp?: number
+}
+
+type SessionData = {
+  messages: ChatMessage[]
+  fragments: any[]
+  template: TemplateId
+  model: string
+  createdAt: number
+  updatedAt: number
+}
+
+type GenerateChatRequest = {
+  sessionId?: string
+  message: string
+  model?: string
+  template?: TemplateId
+}
+
+export async function POST(req: Request) {
+  try {
+    const {
+      sessionId: inputSessionId,
+      message,
+      model = 'gpt-4o',
+      template = 'nextjs-developer',
+    }: GenerateChatRequest = await req.json()
+
+    if (!message) {
+      return new Response('Message is required', { status: 400 })
+    }
+
+    // Check if required API keys are available
+    if (!process.env.OPENAI_API_KEY) {
+      return new Response(
+        JSON.stringify({
+          error: 'OpenAI API key not configured. Please set OPENAI_API_KEY environment variable.'
+        }),
+        { 
+          status: 503,
+          headers: { 'Content-Type': 'application/json' }
+        }
+      )
+    }
+
+    if (!process.env.E2B_API_KEY) {
+      return new Response(
+        JSON.stringify({
+          error: 'E2B API key not configured. Please set E2B_API_KEY environment variable.'
+        }),
+        { 
+          status: 503,
+          headers: { 'Content-Type': 'application/json' }
+        }
+      )
+    }
+
+    // Generate or use existing session ID
+    const sessionId = inputSessionId || `session_${nanoid()}`
+
+    // Retrieve existing session data from KV storage
+    let sessionData: SessionData | null = null
+    if (process.env.KV_REST_API_URL && process.env.KV_REST_API_TOKEN && inputSessionId) {
+      try {
+        sessionData = await kv.get(`chat_session:${sessionId}`)
+      } catch (error) {
+        console.log('KV not available, creating new session')
+      }
+    }
+
+    // Initialize session data if not found
+    if (!sessionData) {
+      sessionData = {
+        messages: [],
+        fragments: [],
+        template,
+        model,
+        createdAt: Date.now(),
+        updatedAt: Date.now()
+      }
+    }
+
+    // Add user message to session
+    const userMessage: ChatMessage = {
+      role: 'user',
+      content: message,
+      timestamp: Date.now()
+    }
+    sessionData.messages.push(userMessage)
+    sessionData.updatedAt = Date.now()
+
+    // Prepare messages for LLM (convert to CoreMessage format)
+    const coreMessages: CoreMessage[] = sessionData.messages.map(msg => ({
+      role: msg.role,
+      content: msg.content
+    }))
+
+    // Set up model configuration
+    const modelConfig: LLMModel = {
+      id: model,
+      name: model,
+      provider: 'openai',
+      providerId: 'openai'
+    }
+
+    const config: LLMModelConfig = {
+      model: model,
+      apiKey: process.env.OPENAI_API_KEY,
+      temperature: 0.7,
+    }
+
+    const modelClient = getModelClient(modelConfig, config)
+
+    // Generate code using LLM with full conversation history
+    const result = await generateObject({
+      model: modelClient as LanguageModel,
+      schema,
+      system: toPrompt(templates),
+      messages: coreMessages,
+      maxRetries: 0,
+    })
+
+    const fragment = result.object
+
+    // Add assistant response to session
+    const assistantMessage: ChatMessage = {
+      role: 'assistant',
+      content: `Generated: ${fragment.title || 'Project'} - ${fragment.description || 'Code generated successfully'}`,
+      timestamp: Date.now()
+    }
+    sessionData.messages.push(assistantMessage)
+    sessionData.fragments.push(fragment)
+
+    // Create E2B sandbox
+    const sbx = await Sandbox.create(fragment.template, {
+      metadata: {
+        template: fragment.template,
+        sessionId: sessionId,
+        userID: '',
+        teamID: '',
+      },
+      timeoutMs: sandboxTimeout,
+    })
+
+    // Install packages if needed
+    if (fragment.has_additional_dependencies) {
+      await sbx.commands.run(fragment.install_dependencies_command)
+      console.log(
+        `Installed dependencies: ${fragment.additional_dependencies.join(', ')} in sandbox ${sbx.sandboxId}`,
+      )
+    }
+
+    // Write code to sandbox
+    if (fragment.code && Array.isArray(fragment.code)) {
+      for (const file of fragment.code) {
+        await sbx.files.write(file.file_path, file.file_content)
+        console.log(`Copied file to ${file.file_path} in ${sbx.sandboxId}`)
+      }
+    } else {
+      await sbx.files.write(fragment.file_path, fragment.code)
+      console.log(`Copied file to ${fragment.file_path} in ${sbx.sandboxId}`)
+    }
+
+    // Get preview URL
+    const previewUrl = `https://${sbx.getHost(fragment.port || 80)}`
+
+    // Publish the project (create short URL if KV is available)
+    let shortUrl: string | undefined
+    try {
+      const publishResult = await publish(
+        previewUrl,
+        sbx.sandboxId,
+        '10m' as Duration,
+        undefined, // teamID
+        undefined, // accessToken
+      )
+      shortUrl = publishResult.url
+    } catch (error) {
+      console.log('Publishing failed, using direct URL:', error)
+      shortUrl = previewUrl
+    }
+
+    // Save updated session data to KV storage
+    if (process.env.KV_REST_API_URL && process.env.KV_REST_API_TOKEN) {
+      try {
+        await kv.set(
+          `chat_session:${sessionId}`, 
+          sessionData,
+          { ex: 24 * 60 * 60 } // 24 hours TTL
+        )
+      } catch (error) {
+        console.log('Failed to save session to KV:', error)
+      }
+    }
+
+    return new Response(
+      JSON.stringify({
+        sessionId,
+        id: sbx.sandboxId,
+        previewUrl,
+        shortUrl,
+        title: fragment.title,
+        description: fragment.description,
+        messageCount: sessionData.messages.length,
+        fragmentCount: sessionData.fragments.length,
+      }),
+      {
+        headers: {
+          'Content-Type': 'application/json',
+        },
+      },
+    )
+
+  } catch (error: any) {
+    console.error('Error in generate chat API:', error)
+
+    const isRateLimitError =
+      error && (error.statusCode === 429 || error.message.includes('limit'))
+    const isOverloadedError =
+      error && (error.statusCode === 529 || error.statusCode === 503)
+    const isAccessDeniedError =
+      error && (error.statusCode === 403 || error.statusCode === 401)
+
+    if (isRateLimitError) {
+      return new Response(
+        'The provider is currently unavailable due to request limit.',
+        { status: 429 }
+      )
+    }
+
+    if (isOverloadedError) {
+      return new Response(
+        'The provider is currently unavailable. Please try again later.',
+        { status: 529 }
+      )
+    }
+
+    if (isAccessDeniedError) {
+      return new Response(
+        'Access denied. Please check your API configuration.',
+        { status: 403 }
+      )
+    }
+
+    return new Response(
+      'An unexpected error has occurred. Please try again later.',
+      { status: 500 }
+    )
+  }
+}
\ No newline at end of file
diff --git a/app/api/generate/route.ts b/app/api/generate/route.ts
new file mode 100644
index 0000000..39959c0
--- /dev/null
+++ b/app/api/generate/route.ts
@@ -0,0 +1,223 @@
+import { Duration } from '@/lib/duration'
+import {
+  getModelClient,
+  LLMModel,
+  LLMModelConfig,
+} from '@/lib/models'
+import { toPrompt } from '@/lib/prompt'
+import { fragmentSchema as schema } from '@/lib/schema'
+import templates, { TemplateId } from '@/lib/templates'
+import { ExecutionResultWeb } from '@/lib/types'
+import { publish } from '@/app/actions/publish'
+import { streamObject, LanguageModel, generateObject } from 'ai'
+import { Sandbox } from '@e2b/code-interpreter'
+
+export const maxDuration = 300
+
+const sandboxTimeout = 10 * 60 * 1000 // 10 minutes in ms
+
+type GenerateRequest = {
+  prompt: string
+  model?: string
+  template?: TemplateId
+  sessionId?: string
+}
+
+export async function POST(req: Request) {
+  try {
+    const {
+      prompt,
+      model = 'gpt-4o',
+      template = 'nextjs-developer',
+      sessionId,
+    }: GenerateRequest = await req.json()
+
+    if (!prompt) {
+      return new Response('Prompt is required', { status: 400 })
+    }
+
+    // If sessionId is provided, redirect to chat API for session-based generation
+    if (sessionId) {
+      const chatApiUrl = new URL('/api/generate/chat', req.url)
+      
+      const chatResponse = await fetch(chatApiUrl.toString(), {
+        method: 'POST',
+        headers: {
+          'Content-Type': 'application/json',
+        },
+        body: JSON.stringify({
+          sessionId,
+          message: prompt,
+          model,
+          template,
+        }),
+      })
+
+      // Return the chat API response
+      const responseBody = await chatResponse.text()
+      return new Response(responseBody, {
+        status: chatResponse.status,
+        headers: {
+          'Content-Type': 'application/json',
+        },
+      })
+    }
+
+    // Default model config for OpenAI
+    const modelConfig: LLMModel = {
+      id: 'gpt-4o',
+      name: 'GPT-4o',
+      provider: 'openai',
+      providerId: 'openai'
+    }
+
+    const config: LLMModelConfig = {
+      model: model,
+      apiKey: process.env.OPENAI_API_KEY,
+      temperature: 0.7,
+    }
+
+    // Check if OpenAI API key is available
+    if (!process.env.OPENAI_API_KEY) {
+      return new Response(
+        JSON.stringify({
+          error: 'OpenAI API key not configured. Please set OPENAI_API_KEY environment variable.'
+        }),
+        { 
+          status: 503,
+          headers: { 'Content-Type': 'application/json' }
+        }
+      )
+    }
+
+    // Check if E2B API key is available
+    if (!process.env.E2B_API_KEY) {
+      return new Response(
+        JSON.stringify({
+          error: 'E2B API key not configured. Please set E2B_API_KEY environment variable.'
+        }),
+        { 
+          status: 503,
+          headers: { 'Content-Type': 'application/json' }
+        }
+      )
+    }
+
+    const modelClient = getModelClient(modelConfig, config)
+
+    // Generate code using LLM
+    const result = await generateObject({
+      model: modelClient as LanguageModel,
+      schema,
+      system: toPrompt(templates),
+      messages: [
+        {
+          role: 'user',
+          content: `Use template: ${template}. ${prompt}`,
+        },
+      ],
+      maxRetries: 0,
+    })
+
+    const fragment = result.object
+
+    // Create E2B sandbox
+    const sbx = await Sandbox.create(fragment.template, {
+      metadata: {
+        template: fragment.template,
+        userID: '',
+        teamID: '',
+      },
+      timeoutMs: sandboxTimeout,
+    })
+
+    // Install packages if needed
+    if (fragment.has_additional_dependencies) {
+      await sbx.commands.run(fragment.install_dependencies_command)
+      console.log(
+        `Installed dependencies: ${fragment.additional_dependencies.join(', ')} in sandbox ${sbx.sandboxId}`,
+      )
+    }
+
+    // Write code to sandbox
+    if (fragment.code && Array.isArray(fragment.code)) {
+      for (const file of fragment.code) {
+        await sbx.files.write(file.file_path, file.file_content)
+        console.log(`Copied file to ${file.file_path} in ${sbx.sandboxId}`)
+      }
+    } else {
+      await sbx.files.write(fragment.file_path, fragment.code)
+      console.log(`Copied file to ${fragment.file_path} in ${sbx.sandboxId}`)
+    }
+
+    // Get preview URL
+    const previewUrl = `https://${sbx.getHost(fragment.port || 80)}`
+
+    // Publish the project (create short URL if KV is available)
+    let shortUrl: string | undefined
+    try {
+      const publishResult = await publish(
+        previewUrl,
+        sbx.sandboxId,
+        '10m' as Duration,
+        undefined, // teamID
+        undefined, // accessToken
+      )
+      shortUrl = publishResult.url
+    } catch (error) {
+      console.log('Publishing failed, using direct URL:', error)
+      shortUrl = previewUrl
+    }
+
+    return new Response(
+      JSON.stringify({
+        id: sbx.sandboxId,
+        previewUrl,
+        shortUrl,
+        title: fragment.title,
+        description: fragment.description,
+      }),
+      {
+        headers: {
+          'Content-Type': 'application/json',
+        },
+      },
+    )
+
+  } catch (error: any) {
+    console.error('Error in generate API:', error)
+
+    const isRateLimitError =
+      error && (error.statusCode === 429 || error.message.includes('limit'))
+    const isOverloadedError =
+      error && (error.statusCode === 529 || error.statusCode === 503)
+    const isAccessDeniedError =
+      error && (error.statusCode === 403 || error.statusCode === 401)
+
+    if (isRateLimitError) {
+      return new Response(
+        'The provider is currently unavailable due to request limit.',
+        { status: 429 }
+      )
+    }
+
+    if (isOverloadedError) {
+      return new Response(
+        'The provider is currently unavailable. Please try again later.',
+        { status: 529 }
+      )
+    }
+
+    if (isAccessDeniedError) {
+      return new Response(
+        'Access denied. Please check your API configuration.',
+        { status: 403 }
+      )
+    }
+
+    return new Response(
+      'An unexpected error has occurred. Please try again later.',
+      { status: 500 }
+    )
+  }
+}
\ No newline at end of file
diff --git a/app/api/generate/session/[sessionId]/route.ts b/app/api/generate/session/[sessionId]/route.ts
new file mode 100644
index 0000000..90ba3b9
--- /dev/null
+++ b/app/api/generate/session/[sessionId]/route.ts
@@ -0,0 +1,158 @@
+import { kv } from '@vercel/kv'
+
+type ChatMessage = {
+  role: 'user' | 'assistant'
+  content: string
+  timestamp?: number
+}
+
+type SessionData = {
+  messages: ChatMessage[]
+  fragments: any[]
+  template: string
+  model: string
+  createdAt: number
+  updatedAt: number
+}
+
+export async function GET(
+  req: Request,
+  { params }: { params: { sessionId: string } }
+) {
+  try {
+    const { sessionId } = params
+
+    if (!sessionId) {
+      return new Response('Session ID is required', { status: 400 })
+    }
+
+    // Check if KV storage is available
+    if (!process.env.KV_REST_API_URL || !process.env.KV_REST_API_TOKEN) {
+      return new Response(
+        JSON.stringify({
+          error: 'Session storage not configured. KV storage required for session management.'
+        }),
+        { 
+          status: 503,
+          headers: { 'Content-Type': 'application/json' }
+        }
+      )
+    }
+
+    // Retrieve session data from KV storage
+    let sessionData: SessionData | null = null
+    try {
+      sessionData = await kv.get(`chat_session:${sessionId}`)
+    } catch (error) {
+      console.error('Failed to retrieve session from KV:', error)
+      return new Response(
+        JSON.stringify({ error: 'Failed to retrieve session data' }),
+        { 
+          status: 500,
+          headers: { 'Content-Type': 'application/json' }
+        }
+      )
+    }
+
+    if (!sessionData) {
+      return new Response(
+        JSON.stringify({ error: 'Session not found' }),
+        { 
+          status: 404,
+          headers: { 'Content-Type': 'application/json' }
+        }
+      )
+    }
+
+    // Return session data
+    return new Response(
+      JSON.stringify({
+        sessionId,
+        messages: sessionData.messages,
+        fragments: sessionData.fragments,
+        template: sessionData.template,
+        model: sessionData.model,
+        messageCount: sessionData.messages.length,
+        fragmentCount: sessionData.fragments.length,
+        createdAt: sessionData.createdAt,
+        updatedAt: sessionData.updatedAt,
+      }),
+      {
+        headers: {
+          'Content-Type': 'application/json',
+        },
+      },
+    )
+
+  } catch (error: any) {
+    console.error('Error in session retrieval API:', error)
+
+    return new Response(
+      JSON.stringify({ error: 'An unexpected error occurred' }),
+      { 
+        status: 500,
+        headers: { 'Content-Type': 'application/json' }
+      }
+    )
+  }
+}
+
+export async function DELETE(
+  req: Request,
+  { params }: { params: { sessionId: string } }
+) {
+  try {
+    const { sessionId } = params
+
+    if (!sessionId) {
+      return new Response('Session ID is required', { status: 400 })
+    }
+
+    // Check if KV storage is available
+    if (!process.env.KV_REST_API_URL || !process.env.KV_REST_API_TOKEN) {
+      return new Response(
+        JSON.stringify({
+          error: 'Session storage not configured. KV storage required for session management.'
+        }),
+        { 
+          status: 503,
+          headers: { 'Content-Type': 'application/json' }
+        }
+      )
+    }
+
+    // Delete session from KV storage
+    try {
+      await kv.del(`chat_session:${sessionId}`)
+    } catch (error) {
+      console.error('Failed to delete session from KV:', error)
+      return new Response(
+        JSON.stringify({ error: 'Failed to delete session data' }),
+        { 
+          status: 500,
+          headers: { 'Content-Type': 'application/json' }
+        }
+      )
+    }
+
+    return new Response(
+      JSON.stringify({ message: 'Session deleted successfully' }),
+      {
+        headers: {
+          'Content-Type': 'application/json',
+        },
+      },
+    )
+
+  } catch (error: any) {
+    console.error('Error in session deletion API:', error)
+
+    return new Response(
+      JSON.stringify({ error: 'An unexpected error occurred' }),
+      { 
+        status: 500,
+        headers: { 'Content-Type': 'application/json' }
+      }
+    )
+  }
+}
\ No newline at end of file
-- 
2.44.0

